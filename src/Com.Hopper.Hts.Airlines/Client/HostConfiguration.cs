/*
 * Airline API
 *
 * No description provided (generated by Openapi Generator https://github.com/openapitools/openapi-generator)
 *
 * The version of the OpenAPI document: v1.1
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

#nullable enable

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.Json;
using System.Text.Json.Serialization;
using System.Net.Http;
using Microsoft.Extensions.DependencyInjection;
using Com.Hopper.Hts.Airlines.Api;
using Com.Hopper.Hts.Airlines.Model;

namespace Com.Hopper.Hts.Airlines.Client
{
    /// <summary>
    /// Provides hosting configuration for Com.Hopper.Hts.Airlines
    /// </summary>
    public class HostConfiguration
    {
        private readonly IServiceCollection _services;
        private readonly JsonSerializerOptions _jsonOptions = new JsonSerializerOptions();

        internal bool HttpClientsAdded { get; private set; }

        /// <summary>
        /// Instantiates the class 
        /// </summary>
        /// <param name="services"></param>
        public HostConfiguration(IServiceCollection services)
        {
            _services = services;
            _jsonOptions.Converters.Add(new JsonStringEnumConverter());
            _jsonOptions.Converters.Add(new DateTimeJsonConverter());
            _jsonOptions.Converters.Add(new DateTimeNullableJsonConverter());
            _jsonOptions.Converters.Add(new DateOnlyJsonConverter());
            _jsonOptions.Converters.Add(new DateOnlyNullableJsonConverter());
            _jsonOptions.Converters.Add(new AirlineRefundMethodJsonConverter());
            _jsonOptions.Converters.Add(new AirlineRefundMethodNullableJsonConverter());
            _jsonOptions.Converters.Add(new AirlineSessionJsonConverter());
            _jsonOptions.Converters.Add(new AncillaryJsonConverter());
            _jsonOptions.Converters.Add(new AncillaryTypeJsonConverter());
            _jsonOptions.Converters.Add(new AncillaryTypeNullableJsonConverter());
            _jsonOptions.Converters.Add(new AndroidJsonConverter());
            _jsonOptions.Converters.Add(new AppJsonConverter());
            _jsonOptions.Converters.Add(new AuthRequestJsonConverter());
            _jsonOptions.Converters.Add(new AuthResponseJsonConverter());
            _jsonOptions.Converters.Add(new BadRequestJsonConverter());
            _jsonOptions.Converters.Add(new BookingConfirmedJsonConverter());
            _jsonOptions.Converters.Add(new BookingConfirmed1JsonConverter());
            _jsonOptions.Converters.Add(new BookingConfirmed2JsonConverter());
            _jsonOptions.Converters.Add(new BrowserJsonConverter());
            _jsonOptions.Converters.Add(new CabinJsonConverter());
            _jsonOptions.Converters.Add(new CabinNullableJsonConverter());
            _jsonOptions.Converters.Add(new CashJsonConverter());
            _jsonOptions.Converters.Add(new CfarContentsJsonConverter());
            _jsonOptions.Converters.Add(new CfarContractJsonConverter());
            _jsonOptions.Converters.Add(new CfarContractExerciseJsonConverter());
            _jsonOptions.Converters.Add(new CfarCreateExerciseItineraryJsonConverter());
            _jsonOptions.Converters.Add(new CfarCreateExerciseItinerarySliceJsonConverter());
            _jsonOptions.Converters.Add(new CfarCreateExercisePassengerPricingJsonConverter());
            _jsonOptions.Converters.Add(new CfarCreateExerciseSliceSegmentJsonConverter());
            _jsonOptions.Converters.Add(new CfarDenyPurchaseJsonConverter());
            _jsonOptions.Converters.Add(new CfarEventJsonConverter());
            _jsonOptions.Converters.Add(new CfarEventWithContractJsonConverter());
            _jsonOptions.Converters.Add(new CfarExerciseCallbackLaunchedJsonConverter());
            _jsonOptions.Converters.Add(new CfarExerciseCustomerDataCompleteJsonConverter());
            _jsonOptions.Converters.Add(new CfarExercisePortalCompleteJsonConverter());
            _jsonOptions.Converters.Add(new CfarExercisePortalDisplayJsonConverter());
            _jsonOptions.Converters.Add(new CfarExerciseVerificationCompleteJsonConverter());
            _jsonOptions.Converters.Add(new CfarExerciseVerificationSentJsonConverter());
            _jsonOptions.Converters.Add(new CfarForcedChoiceWarningJsonConverter());
            _jsonOptions.Converters.Add(new CfarItineraryJsonConverter());
            _jsonOptions.Converters.Add(new CfarItinerarySliceJsonConverter());
            _jsonOptions.Converters.Add(new CfarItinerarySliceSegmentJsonConverter());
            _jsonOptions.Converters.Add(new CfarOfferJsonConverter());
            _jsonOptions.Converters.Add(new CfarOfferItineraryJsonConverter());
            _jsonOptions.Converters.Add(new CfarOfferPassengerJsonConverter());
            _jsonOptions.Converters.Add(new CfarOfferSelectedJsonConverter());
            _jsonOptions.Converters.Add(new CfarOffersBannerDisplayJsonConverter());
            _jsonOptions.Converters.Add(new CfarOffersBannerLoadedJsonConverter());
            _jsonOptions.Converters.Add(new CfarOffersMoreInfoClickedJsonConverter());
            _jsonOptions.Converters.Add(new CfarOffersTakeoverDisplayJsonConverter());
            _jsonOptions.Converters.Add(new CfarPassengerJsonConverter());
            _jsonOptions.Converters.Add(new CfarPassengerTaxJsonConverter());
            _jsonOptions.Converters.Add(new CfarPaymentJsonConverter());
            _jsonOptions.Converters.Add(new CfarStatusJsonConverter());
            _jsonOptions.Converters.Add(new CfarStatusNullableJsonConverter());
            _jsonOptions.Converters.Add(new CfarTaxJsonConverter());
            _jsonOptions.Converters.Add(new CfarViewInfoJsonConverter());
            _jsonOptions.Converters.Add(new ChromeJsonConverter());
            _jsonOptions.Converters.Add(new ChromeOsJsonConverter());
            _jsonOptions.Converters.Add(new CreateAirlineCfarSessionRequestJsonConverter());
            _jsonOptions.Converters.Add(new CreateAirlineDgSessionRequestJsonConverter());
            _jsonOptions.Converters.Add(new CreateAirlineSessionRequestJsonConverter());
            _jsonOptions.Converters.Add(new CreateCfarContractExerciseRequestJsonConverter());
            _jsonOptions.Converters.Add(new CreateCfarContractRequestJsonConverter());
            _jsonOptions.Converters.Add(new CreateCfarOfferRequestJsonConverter());
            _jsonOptions.Converters.Add(new CreateDgContractExerciseRequestJsonConverter());
            _jsonOptions.Converters.Add(new CreateDgContractExerciseResponseJsonConverter());
            _jsonOptions.Converters.Add(new CreateDgContractRequestJsonConverter());
            _jsonOptions.Converters.Add(new CreateDgOfferItemResponseJsonConverter());
            _jsonOptions.Converters.Add(new CreateDgOffersRequestJsonConverter());
            _jsonOptions.Converters.Add(new DesktopJsonConverter());
            _jsonOptions.Converters.Add(new DeviceJsonConverter());
            _jsonOptions.Converters.Add(new DgAncillaryJsonConverter());
            _jsonOptions.Converters.Add(new DgAncillaryTypeJsonConverter());
            _jsonOptions.Converters.Add(new DgAncillaryTypeNullableJsonConverter());
            _jsonOptions.Converters.Add(new DgContentsJsonConverter());
            _jsonOptions.Converters.Add(new DgContractJsonConverter());
            _jsonOptions.Converters.Add(new DgDenyPurchaseJsonConverter());
            _jsonOptions.Converters.Add(new DgEventJsonConverter());
            _jsonOptions.Converters.Add(new DgExerciseCallbackLaunchedJsonConverter());
            _jsonOptions.Converters.Add(new DgExerciseCustomerDataCompleteJsonConverter());
            _jsonOptions.Converters.Add(new DgExerciseItineraryJsonConverter());
            _jsonOptions.Converters.Add(new DgExerciseItinerarySliceJsonConverter());
            _jsonOptions.Converters.Add(new DgExerciseItinerarySliceSegmentJsonConverter());
            _jsonOptions.Converters.Add(new DgExercisePortalCompleteJsonConverter());
            _jsonOptions.Converters.Add(new DgExerciseVerificationCompleteJsonConverter());
            _jsonOptions.Converters.Add(new DgItineraryJsonConverter());
            _jsonOptions.Converters.Add(new DgItinerarySliceJsonConverter());
            _jsonOptions.Converters.Add(new DgItinerarySliceSegmentJsonConverter());
            _jsonOptions.Converters.Add(new DgOfferJsonConverter());
            _jsonOptions.Converters.Add(new DgOfferSelectedJsonConverter());
            _jsonOptions.Converters.Add(new DgOffersBannerDisplayJsonConverter());
            _jsonOptions.Converters.Add(new DgOffersBannerLoadedJsonConverter());
            _jsonOptions.Converters.Add(new DgOffersMoreInfoClickedJsonConverter());
            _jsonOptions.Converters.Add(new DgPassengerJsonConverter());
            _jsonOptions.Converters.Add(new DgPassengerCountJsonConverter());
            _jsonOptions.Converters.Add(new DgPassengerPricingJsonConverter());
            _jsonOptions.Converters.Add(new DgPassengerTaxJsonConverter());
            _jsonOptions.Converters.Add(new DgPassengerTypeJsonConverter());
            _jsonOptions.Converters.Add(new DgPassengerTypeNullableJsonConverter());
            _jsonOptions.Converters.Add(new DgPaymentJsonConverter());
            _jsonOptions.Converters.Add(new DgRequestTypeJsonConverter());
            _jsonOptions.Converters.Add(new DgRequestTypeNullableJsonConverter());
            _jsonOptions.Converters.Add(new DgStatusJsonConverter());
            _jsonOptions.Converters.Add(new DgStatusNullableJsonConverter());
            _jsonOptions.Converters.Add(new DgTaxJsonConverter());
            _jsonOptions.Converters.Add(new EdgeJsonConverter());
            _jsonOptions.Converters.Add(new ErrorJsonConverter());
            _jsonOptions.Converters.Add(new EventJsonConverter());
            _jsonOptions.Converters.Add(new ExerciseStepResultJsonConverter());
            _jsonOptions.Converters.Add(new ExerciseStepResultNullableJsonConverter());
            _jsonOptions.Converters.Add(new FareJsonConverter());
            _jsonOptions.Converters.Add(new FareClassJsonConverter());
            _jsonOptions.Converters.Add(new FareClassNullableJsonConverter());
            _jsonOptions.Converters.Add(new FareRuleJsonConverter());
            _jsonOptions.Converters.Add(new FirefoxJsonConverter());
            _jsonOptions.Converters.Add(new FlightStatusJsonConverter());
            _jsonOptions.Converters.Add(new FlightStatusNullableJsonConverter());
            _jsonOptions.Converters.Add(new FlowTypeJsonConverter());
            _jsonOptions.Converters.Add(new FlowTypeNullableJsonConverter());
            _jsonOptions.Converters.Add(new FormOfPaymentJsonConverter());
            _jsonOptions.Converters.Add(new GenderJsonConverter());
            _jsonOptions.Converters.Add(new GenderNullableJsonConverter());
            _jsonOptions.Converters.Add(new IOsJsonConverter());
            _jsonOptions.Converters.Add(new InternetExplorerJsonConverter());
            _jsonOptions.Converters.Add(new LinuxJsonConverter());
            _jsonOptions.Converters.Add(new MacOsJsonConverter());
            _jsonOptions.Converters.Add(new MarkCfarContractExerciseCompleteRequestJsonConverter());
            _jsonOptions.Converters.Add(new MobileJsonConverter());
            _jsonOptions.Converters.Add(new ModelOperatingSystemJsonConverter());
            _jsonOptions.Converters.Add(new ModificationTimeJsonConverter());
            _jsonOptions.Converters.Add(new ModificationTimeNullableJsonConverter());
            _jsonOptions.Converters.Add(new ModificationTypeJsonConverter());
            _jsonOptions.Converters.Add(new ModificationTypeNullableJsonConverter());
            _jsonOptions.Converters.Add(new NonCashJsonConverter());
            _jsonOptions.Converters.Add(new OffersDisplayedJsonConverter());
            _jsonOptions.Converters.Add(new OffersDisplayed1JsonConverter());
            _jsonOptions.Converters.Add(new OperaJsonConverter());
            _jsonOptions.Converters.Add(new OtherBrowserJsonConverter());
            _jsonOptions.Converters.Add(new OtherOsJsonConverter());
            _jsonOptions.Converters.Add(new PassengerCountJsonConverter());
            _jsonOptions.Converters.Add(new PassengerPricingJsonConverter());
            _jsonOptions.Converters.Add(new PassengerTypeJsonConverter());
            _jsonOptions.Converters.Add(new PassengerTypeNullableJsonConverter());
            _jsonOptions.Converters.Add(new PaymentCardJsonConverter());
            _jsonOptions.Converters.Add(new PlatformJsonConverter());
            _jsonOptions.Converters.Add(new PointsJsonConverter());
            _jsonOptions.Converters.Add(new ProcessCfarPaymentRequestJsonConverter());
            _jsonOptions.Converters.Add(new ProcessDgPaymentRequestJsonConverter());
            _jsonOptions.Converters.Add(new ProductJsonConverter());
            _jsonOptions.Converters.Add(new ProductNullableJsonConverter());
            _jsonOptions.Converters.Add(new RequestTypeJsonConverter());
            _jsonOptions.Converters.Add(new RequestTypeNullableJsonConverter());
            _jsonOptions.Converters.Add(new SafariJsonConverter());
            _jsonOptions.Converters.Add(new TabletJsonConverter());
            _jsonOptions.Converters.Add(new TokenTypeJsonConverter());
            _jsonOptions.Converters.Add(new TokenTypeNullableJsonConverter());
            _jsonOptions.Converters.Add(new UiSourceJsonConverter());
            _jsonOptions.Converters.Add(new UiSourceNullableJsonConverter());
            _jsonOptions.Converters.Add(new UiVariantJsonConverter());
            _jsonOptions.Converters.Add(new UiVariantNullableJsonConverter());
            _jsonOptions.Converters.Add(new UnprocessableEntityJsonConverter());
            _jsonOptions.Converters.Add(new UpdateCfarContractRequestJsonConverter());
            _jsonOptions.Converters.Add(new UpdateCfarFormOfPaymentRequestJsonConverter());
            _jsonOptions.Converters.Add(new UpdateDgContractStatusRequestJsonConverter());
            _jsonOptions.Converters.Add(new UserInfoJsonConverter());
            _jsonOptions.Converters.Add(new WebJsonConverter());
            _jsonOptions.Converters.Add(new WindowsJsonConverter());
            JsonSerializerOptionsProvider jsonSerializerOptionsProvider = new(_jsonOptions);
            _services.AddSingleton(jsonSerializerOptionsProvider);
            _services.AddSingleton<IApiFactory, ApiFactory>();
            _services.AddSingleton<AnalyticsApiEvents>();
            _services.AddTransient<IAnalyticsApi, AnalyticsApi>();
            _services.AddSingleton<AuthenticationApiEvents>();
            _services.AddTransient<IAuthenticationApi, AuthenticationApi>();
            _services.AddSingleton<CancelForAnyReasonCFARApiEvents>();
            _services.AddTransient<ICancelForAnyReasonCFARApi, CancelForAnyReasonCFARApi>();
            _services.AddSingleton<DisruptionGuaranteeDGApiEvents>();
            _services.AddTransient<IDisruptionGuaranteeDGApi, DisruptionGuaranteeDGApi>();
            _services.AddSingleton<SessionsApiEvents>();
            _services.AddTransient<ISessionsApi, SessionsApi>();
        }

        /// <summary>
        /// Configures the HttpClients.
        /// </summary>
        /// <param name="client"></param>
        /// <param name="builder"></param>
        /// <returns></returns>
        public HostConfiguration AddApiHttpClients
        (
            Action<HttpClient>? client = null, Action<IHttpClientBuilder>? builder = null)
        {
            if (client == null)
                client = c => c.BaseAddress = new Uri(ClientUtils.BASE_ADDRESS);

            List<IHttpClientBuilder> builders = new List<IHttpClientBuilder>();

            builders.Add(_services.AddHttpClient<IAnalyticsApi, AnalyticsApi>(client));
            builders.Add(_services.AddHttpClient<IAuthenticationApi, AuthenticationApi>(client));
            builders.Add(_services.AddHttpClient<ICancelForAnyReasonCFARApi, CancelForAnyReasonCFARApi>(client));
            builders.Add(_services.AddHttpClient<IDisruptionGuaranteeDGApi, DisruptionGuaranteeDGApi>(client));
            builders.Add(_services.AddHttpClient<ISessionsApi, SessionsApi>(client));
            
            if (builder != null)
                foreach (IHttpClientBuilder instance in builders)
                    builder(instance);

            HttpClientsAdded = true;

            return this;
        }

        /// <summary>
        /// Configures the JsonSerializerSettings
        /// </summary>
        /// <param name="options"></param>
        /// <returns></returns>
        public HostConfiguration ConfigureJsonOptions(Action<JsonSerializerOptions> options)
        {
            options(_jsonOptions);

            return this;
        }

        /// <summary>
        /// Adds tokens to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <param name="token"></param>
        /// <returns></returns>
        public HostConfiguration AddTokens<TTokenBase>(TTokenBase token) where TTokenBase : TokenBase
        {
            return AddTokens(new TTokenBase[]{ token });
        }

        /// <summary>
        /// Adds tokens to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <param name="tokens"></param>
        /// <returns></returns>
        public HostConfiguration AddTokens<TTokenBase>(IEnumerable<TTokenBase> tokens) where TTokenBase : TokenBase
        {
            TokenContainer<TTokenBase> container = new TokenContainer<TTokenBase>(tokens);
            _services.AddSingleton(services => container);

            return this;
        }

        /// <summary>
        /// Adds a token provider to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenProvider"></typeparam>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <returns></returns>
        public HostConfiguration UseProvider<TTokenProvider, TTokenBase>() 
            where TTokenProvider : TokenProvider<TTokenBase>
            where TTokenBase : TokenBase
        {
            _services.AddSingleton<TTokenProvider>();
            _services.AddSingleton<TokenProvider<TTokenBase>>(services => services.GetRequiredService<TTokenProvider>());

            return this;
        }
    }
}
